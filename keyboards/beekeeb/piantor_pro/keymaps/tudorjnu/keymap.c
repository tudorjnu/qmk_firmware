#include "features/layer_lock.h"
#include QMK_KEYBOARD_H

enum custom_keycodes {
    LLOCK = SAFE_RANGE,
};

enum layer_names {
    _BASE,
    _SYM,
    _NAV_NUMS,
    _FN,
    _LAUNCH,
    _UTILS,
};

const uint16_t PROGMEM utils_layer[] = {LT(_NAV_NUMS, KC_TAB), LT(_NAV_NUMS, KC_ENTER), COMBO_END};

combo_t key_combos[] = {
    COMBO(utils_layer, MO(_UTILS)),
};

// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [_BASE] = LAYOUT_split_3x6_3(
    //,----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       KC_PSCR,         KC_Q,            KC_W,            KC_E,            KC_R,            KC_T,                                 KC_Y,            KC_U,            KC_I,            KC_O,            KC_P,            XXXXXXX,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       KC_ESCAPE,       LALT_T(KC_A),    LGUI_T(KC_S),    LSFT_T(KC_D),    LCTL_T(KC_F),    KC_G,                                 KC_H,            RCTL_T(KC_J),    RSFT_T(KC_K),    RGUI_T(KC_L),    RALT_T(KC_SCLN), XXXXXXX,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       LLOCK,           KC_Z,            KC_X,            KC_C,            KC_V,            KC_B,                                 KC_N,            KC_M,            KC_COMMA,        KC_DOT,          KC_SLASH,        LLOCK,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
                                                     LT(_FN, KC_DEL),   LT(_SYM, KC_BSPC),  LT(_NAV_NUMS, KC_TAB),           LT(_NAV_NUMS, KC_ENTER), LT(_SYM, KC_SPACE), LT(_FN, KC_NO)
                                                             //`----------------+----------------+----------------'       `----------------+----------------+----------------'
    ),

    [_SYM] = LAYOUT_split_3x6_3(
    //,----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       XXXXXXX,         KC_QUOTE,        S(KC_COMMA),     S(KC_DOT),       S(KC_QUOTE),     KC_GRAVE,                             S(KC_7),         S(KC_MINUS),     KC_LBRC,         KC_RBRC,         S(KC_5),         XXXXXXX,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       XXXXXXX,         S(KC_1),         KC_MINUS,        S(KC_EQUAL),     KC_EQUAL,        S(KC_3),                              S(KC_BSLS),      S(KC_SCLN),      S(KC_9),         S(KC_0),         KC_SCLN,         XXXXXXX,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       _______,         S(KC_6),         KC_SLSH,         S(KC_8),         KC_BSLS,         S(KC_2),                              S(KC_GRAVE),     S(KC_4),         S(KC_LBRC),      S(KC_RBRC),      S(KC_SLSH),      _______,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
                                                                _______,         _______,         _______,                 _______,         _______,         _______
                                                             //`----------------+----------------+----------------'       `----------------+----------------+----------------'
    ),

    [_NAV_NUMS] = LAYOUT_split_3x6_3(
    //,----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       XXXXXXX,         KC_9,            KC_8,            KC_7,            KC_6,            KC_5,                                 KC_HOME,         KC_PGDN,         KC_PGUP,         KC_END,          XXXXXXX,         XXXXXXX,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       XXXXXXX,         LALT_T(KC_4),    LGUI_T(KC_3),    LSFT_T(KC_2),    LCTL_T(KC_1),    KC_0,                                 KC_LEFT,         RCTL_T(KC_DOWN), RSFT_T(KC_UP),   RGUI_T(KC_RIGHT), RALT(XXXXXXX),  XXXXXXX,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       _______,         KC_UNDO,         KC_CUT,          KC_COPY,         KC_PASTE,         XXXXXXX,                              LALT(KC_LEFT),   RCTL(KC_PGDN),   RCTL(KC_PGUP),   LALT(KC_RIGHT),  XXXXXXX,         _______,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
                                                                _______,         _______,         _______,                 _______,         _______,         _______
                                                             //`----------------+----------------+----------------'       `----------------+----------------+----------------'
    ),

    [_FN] = LAYOUT_split_3x6_3(
    //,----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       KC_F10,          KC_F9,           KC_F8,           KC_F7,           KC_F6,           KC_F5,                                KC_MUTE,         KC_VOLD,         KC_VOLU,         XXXXXXX,         XXXXXXX,         XXXXXXX,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       KC_F11,          LALT_T(KC_F4),   LGUI_T(KC_F3),   LSFT_T(KC_F2),   LCTL_T(KC_F1),   XXXXXXX,                              KC_MPLY,         RCTL_T(KC_MNXT), RSFT_T(KC_MPRV), KC_RGUI,         KC_RALT,         XXXXXXX,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       KC_F12,          LCA(KC_F4),      LCA(KC_F3),      LCA(KC_F2),      LCA(KC_F1),      XXXXXXX,                              XXXXXXX,         KC_BRID,         KC_BRIU,         XXXXXXX,         XXXXXXX,         _______,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
                                                                _______,         _______,         _______,                 _______,         _______,         _______
                                                             //`----------------+----------------+----------------'       `----------------+----------------+----------------'
    ),

    [_UTILS] = LAYOUT_split_3x6_3(
    //,----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       XXXXXXX,         XXXXXXX,         XXXXXXX,         XXXXXXX,         KC_SLEP,         KC_PWR,                               DT_PRNT,         DT_DOWN,         DT_UP,           AC_TOGG,         QK_BOOT,         XXXXXXX,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       XXXXXXX,         XXXXXXX,         XXXXXXX,         XXXXXXX,         XXXXXXX,         XXXXXXX,                              XXXXXXX,         XXXXXXX,         XXXXXXX,         XXXXXXX,         XXXXXXX,         XXXXXXX,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
       _______,         XXXXXXX,         XXXXXXX,         XXXXXXX,         KC_CALC,         XXXXXXX,                              XXXXXXX,         XXXXXXX,         XXXXXXX,         XXXXXXX,         XXXXXXX,         _______,
    //|----------------+----------------+----------------+----------------+----------------+----------------|                    |----------------+----------------+----------------+----------------+----------------+----------------|
                                                                _______,         _______,         _______,                 _______,         _______,         _______
                                                             //`----------------+----------------+----------------'       `----------------+----------------+----------------'
    )
};
// clang-format on

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    if (!process_layer_lock(keycode, record, LLOCK)) {
        return false;
    }
    switch (keycode) {
        case LT(3, KC_NO):
            if (record->tap.count && record->event.pressed) {
                tap_code16(LCTL(KC_B));
                return false;
            }
            break;
        default:
            return true;
    }
    return true;
}
